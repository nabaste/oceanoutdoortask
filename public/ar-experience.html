<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
<script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
<script>
    // Get the model data from the query string
    const urlParams = new URLSearchParams(window.location.search);
    const modelId = urlParams.get('modelId');

    // Load the appropriate 3D model based on the modelId
    window.addEventListener('DOMContentLoaded', () => {
        const modelAsset = document.querySelector('#model-asset');
        switch (modelId) {
            case '0':
                modelAsset.setAttribute('src', '/models/Sneaker_Blue_Orange.glb');
                break;
            case '1':
                modelAsset.setAttribute('src', '/models/Sneaker_Red_Blue.glb');
                break;
            case '2':
                modelAsset.setAttribute('src', '/models/Sneaker_Yellow_Green.glb');
                break;
            default:
                modelAsset.setAttribute('src', '/models/Sneaker_Blue_Orange.glb');
        }

        const modelEntity = document.querySelector('#shoe-model');
        modelEntity.setAttribute('gltf-model', '#model-asset');
    });
</script>

<style>
    body {
        margin: 0;
        overflow: hidden;
    }
    #closeButton {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        background-color: rgba(255, 255, 255, 0.7);
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }
</style>
<body>
<button id="closeButton" onclick="goBack()">Ã—</button>

<a-scene
        arjs="trackingMethod: best; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 4x4_BCH_13_5_5;"
        embedded
        renderer="logarithmicDepthBuffer: true;"
        vr-mode-ui="enabled: false"
        gesture-detector
        id="scene"
>
    <a-assets>
        <a-asset-item
                id="model-asset"
                src="/models/Sneaker_Blue_Orange.glb"
        >
        </a-asset-item>
    </a-assets>

    <a-marker
            type="barcode"
            value="10"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;"
            id="markerA"
    >
        <a-entity
                id="shoe-model"
                gltf-model="#shoe"
                position="0 0 0"
                rotation="-45 45 -90"
                class="clickable"
                gesture-handler="minScale: 0.25; maxScale: 3"
                animation-manager
        >
        </a-entity>
        <a-light type="point" color="#fff" intensity="5" position="0 2 2"></a-light>
        <a-light type="point" color="#fff" intensity="5" position="2 2 0"></a-light>
        <a-light type="point" color="#fff" intensity="5" position="2 0 2"></a-light>

    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<script>
    function goBack() {
        window.history.back();
    }

    AFRAME.registerComponent('animation-manager', {
        init: function () {
            const marker = document.querySelector('#markerA'); // Attach to your marker entity
            marker.addEventListener('markerFound', () => {
                if (!this.animationPlayed) {
                    this.playIntroAnimation();
                    this.animationPlayed = true;
                }
            });

            marker.addEventListener('markerLost', () => {
                // this.animationPlayed = false;  // Reset animation state on marker loss
                // Optionally reset other attributes here
            });
        },

        playIntroAnimation: function () {
            this.el.setAttribute('animation__scale', {
                property: 'scale',
                from: '0 0 0',
                to: '20 20 20',
                dur: 5000,
                easing: 'easeOutElastic'
            });

            this.el.setAttribute('animation__spin', {
                property: 'rotation',
                from: '-90 90 -90',
                to: '-405 405 -445',
                dur: 5000,
                easing: 'easeOutCubic'
            });
        }
    });
</script>

</body>
</html>